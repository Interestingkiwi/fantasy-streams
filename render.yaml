# Configuration for hosting on Render.com
# You can connect your GitHub repository and Render will
# use this file to automatically configure the service.

services:
  # 1. Your existing Web Service
  - type: web
    name: fantasy-optimizer
    env: python
    plan: starter
    branch: main
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn -c gunicorn.conf.py app:app -w 4 -k gevent --timeout 120 --graceful-timeout 120"
    healthCheckPath: /healthz
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.4
      - key: YAHOO_CONSUMER_KEY
        sync: false
      - key: YAHOO_CONSUMER_SECRET
        sync: false
      - key: FLASK_SECRET_KEY
        generateValue: true
    disk:
      name: db-storage
      mountPath: /var/data/dbs
      sizeGB: 1

  # 2. Your NEW Background Worker
  # This replaces both old cron jobs
  - type: worker
    name: scheduler-worker
    env: python
    plan: starter # Must be on a paid plan to run 24/7
    branch: main
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python worker.py"
    envVars:
      # All env vars needed for your jobs
      - key: PYTHON_VERSION
        value: 3.11.4
      - key: LEAGUE_ID
        sync: false
      - key: YAHOO_CONSUMER_KEY
        sync: false
      - key: YAHOO_CONSUMER_SECRET
        sync: false
      - key: YAHOO_AUTH_JSON
        sync: false
    disk:
      name: projection-storage # Attaches the same disk
      mountPath: /var/data/dbs
      sizeGB: 1
